<!DOCTYPE html>
<html>
<head><title>Role × Feature</title><link rel="stylesheet" href="/styles.css">
<style>table{border-collapse:collapse;width:100%}th,td{border:1px solid #ddd;padding:6px 8px;text-align:center}</style>
</head>
<body>
  <%- include('partials/header') %>
  <div class="container">
    <h1>Role × Feature</h1>
    <p><a class="btn" href="/admin/assignable">Manager × Target</a></p>
    <table>
      <thead><tr><th>Role \\ Feature</th>
        <% perms.forEach(function(p){ %><th><%= p.name %></th><% }) %>
      </tr></thead>
      <tbody>
        <% roles.forEach(function(r){ %>
          <tr>
            <td><strong><%= r.name %></strong></td>
            <% perms.forEach(function(p){
              var has = (rolePermsMap.get(r.id) || new Set()).has(p.id);
            %>
              <td>
                <form method="POST" action="/admin/features/toggle">
                  <input type="hidden" name="roleId" value="<%= r.id %>">
                  <input type="hidden" name="permissionId" value="<%= p.id %>">
                  <input type="hidden" name="enabled" value="<%= has ? 0 : 1 %>">
                  <button class="btn btn-xs <%= has?'':'btn-outline' %>" type="submit"><%= has?'On':'Off' %></button>
                </form>
              </td>
            <% }) %>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</body>
</html>
