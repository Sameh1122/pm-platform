<!DOCTYPE html>
<html>
<head>
  <title>Role Permissions</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    .muted{color:var(--muted);font-size:13px}
    table.perm{border-collapse:collapse;width:100%}
    table.perm th, table.perm td{border:1px solid var(--border);padding:6px 8px;text-align:center}
    table.perm th.sticky{position:sticky;top:0;background:var(--card)}
    .left{text-align:left}
  </style>
</head>
<body>
  <%- include('partials/header') %>
  <%- include('partials/dashbar', { user }) %>

  <div class="container">
    <div class="header">
      <h1>Role Permissions</h1>
      <p class="muted">Toggle features (permissions) for each role.</p>
    </div>

    <div class="card" style="overflow:auto;">
      <table class="perm">
        <thead>
          <tr>
            <th class="left sticky">Role \ Feature</th>
            <% perms.forEach(function(p){ %>
              <th class="sticky"><%= p.name %></th>
            <% }) %>
          </tr>
        </thead>
        <tbody>
          <% roles.forEach(function(r){ %>
            <tr>
              <td class="left"><strong><%= r.name %></strong></td>
              <% perms.forEach(function(p){
                   var has = (rolePermsMap.get(r.id) || new Set()).has(p.id);
              %>
                <td>
                  <form method="POST" action="/admin/permissions/toggle">
                    <input type="hidden" name="roleId" value="<%= r.id %>">
                    <input type="hidden" name="permissionId" value="<%= p.id %>">
                    <input type="hidden" name="enabled" value="<%= has ? 0 : 1 %>">
                    <button class="btn btn-xs <%= has?'':'btn-outline' %>" type="submit"><%= has?'On':'Off' %></button>
                  </form>
                </td>
              <% }) %>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
